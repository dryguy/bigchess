test_that("san2lan correctly converts SAN to LAN", {
  expect_equal(san2lan("1. e4 e5 2. Nf3 Nf5 3. d5"), "e2e4 e7e5 g1f3 g8f5 d2d5")
  expect_equal(san2lan("1. e4 c5 2. Nf3 d6 3. d4"), "e2e4 c7c5 g1f3 d7d6 d2d4")
})

test_that("san2lan handles empty input", {
  expect_equal(san2lan(""), "")
})

test_that("san2lan handles non-standard input", {
  expect_error(san2lan("This is not a valid input"))
})

test_that("previous bug is gone", {
  movetext <- "1. b4 b5 2. Nc3 Bb7 3. a4 Nc6 4. Ba3 Rb8 5. h3 g6 6. h4 Nh6 7. Nf3 e5 8. Rb1 e4 9. Nh2 Ng8 10. Nf3 Nf6 11. d3 Ne5 12. Rg1 Bd6 13. g4 exf3 14. Rb3 Nh5 15. exf3 Qf6 16. Qc1 Ng7 17. Qd1 Qe7 18. f4 Bxb4 19. Rxb4 d6 20. axb5 Ra8 21. Qb1 Rc8 22. f3 Qd7 23. Rc4 Ke7 24. Nd5+ Kd8 25. Ra4 a5 26. Nb6 Nh5 27. Nxc8 Nxf3+ 28. Kf2 d5 29. Rd4 Ne5 30. Nd6 Qe8 31. Bc5 Kd7 32. Ra4 Qf8 33. Qb3 Qg8 34. Kg2 f6 35. Ra1 g5 36. Bf2 Qa8 37. Nc8 Kd8 38. Kh1 Qa7 39. Rc1 Qe3 40. Kg2 a4 41. Bxe3 Nxf4+ 42. Bxf4 axb3 43. b6 Nc4 44. Kh1 Nxb6 45. Be5 Kxc8 46. Rg3 Ba6 47. Bc3 bxc2 48. h5 h6 49. Bb4 c6 50. Rb1 cxb1=B 51. Ba3 Na4 52. Rf3 Bb7 53. Rxf6 d4 54. Bb2 Nb6 55. Kg2 Bc2 56. Ba3 Kd8 57. Rf7 Rf8 58. Bb2 Bxd3 59. Re7 Na8 60. Bc3 Bb5 61. Bd3 Rf3 62. Be2 Bc8 63. Ba5+ Kxe7 64. Bb4+ Kd7 65. Kh1 Bb7 66. Ba3 Nb6 67. Bxb5 Ke8 68. Be7 Rf5 69. Bf8 Rf7 70. Bf1 Nd7 71. Bd6 Rf2 72. Kg1 Rb2 73. Be2 Nf8 74. Bb8 Ba8 75. Kh2 Rxb8 76. Bd1 Rb4 77. Kh3 Kd7 78. Kg3 Rb5 79. Bf3 Kd8 80. Be2 Rb8 81. Kg2 Rb3 82. Bd1 Rb4 83. Be2 c5+ 84. Kg1 Rc4 85. Bd3 Be4 86. Bxe4 Kc7 87. Bc6 Rc2 88. Bf3 Ne6 89. Kh1 Rg2 90. Bb7 Kd6 91. Bxg2 c4 92. Bc6 Ke5 93. Be8 Nc5 94. Bb5 c3 95. Bc6 Na6 96. Bd5 Kd6 97. Bb3 d3 98. Kg1 Ke7 99. Be6 Nc7 100. Kg2 Kf6 101. Bf7 Ke5 102. Be6 Kd4 103. Kh1 Nxe6 104. Kg2 Nf8 105. Kf3 Kd5 106. Kf2 Ke4 107. Ke1 Kd4 108. Kf2 Nh7 109. Kg1 Nf8 110. Kf1 Nd7 111. Kg2 Ne5 112. Kh3 d2 113. Kg3 d1=N 114. Kg2 Ke3 115. Kg3 Nd3 116. Kh2 N1b2 117. Kg1 Kf3 118. Kf1 Nb4 119. Kg1 Kf4 120. Kf1 Na2 121. Ke2 Nd1 122. Kd3 Nf2+ 123. Kc2 Nd1 124. Kb3 Ke3 125. Ka4 Nc1 126. Kb4 Kf3 127. Kc5 Na2 128. Kc4 Ke2 129. Kd4 Nc1 130. Kc5 c2 131. Kd4 Nc3 132. Kc5 Na4+ 133. Kc6 Kd1 134. Kd6 Na2 135. Ke5 c1=Q 136. Ke6 Qa1 137. Kf7 Nc5 138. Kg6 Nc1 139. Kf7 N5d3 140. Ke7 Na2 141. Ke8 Qe5+ 142. Kf7 Qd4 143. Ke6 Qa4 144. Kf5 Ne1 145. Kg6 Nf3 146. Kf5 Kd2 147. Kf6 Qa5 148. Ke6 Nh2 149. Ke7 Qc3 150. Kd7 Qa1 151. Ke6 Qc1 152. Kf7 Qf1+ 153. Kg8 Ke1 154. Kh7 Qd3+ 155. Kxh6 Qd2 156. Kg7 Nf3 157. Kh8 Kf1 158. Kh7 Qg2 159. Kg8 Ke1 160. Kh8 Qc2 161. Kg8 Qg2 162. Kf8 Qe2 163. h6 Nd4 164. h7 Qd2 165. Kg8 Qc2 166. h8=R Nb5 167. Rh1+ Kf2 168. Kh8 Nc7 169. Rh2+ Kf3 170. Rd2 Qa4 171. Rd6 Qa7 172. Ra6 Qf2 173. Kg7 Qe1 174. Ra3+ Nc3 175. Kh8 Qe7 176. Ra7 Qe4 177. Kg7 Qf5 178. Ra3 Qe6 179. Ra7 Qd6 180. Ra5 Qf4 181. Ra8 Kg3 182. Kh6 Kh3 183. Rg8 Qf7 184. Rb8 Qg6+ 185. Kxg6 N7b5 186. Rg8 Kh2 187. Rc8 Nc7 188. Rd8 Nd1 189. Kf5 Ne6 190. Rd4 Nd8 191. Kxg5 Nc3 192. Kh6 Nd5 193. Rd2+ Kh3 194. Rd4 Kh4 195. Kg7 Ne3 196. Kf6 Kg3 197. Rd5 Ng2 198. Re5 Nh4 199. Re7 Nb7 200. Re8 Nf5 201. Re4 Nc5 202. Re3+ Kf2 203. Kf7 Ne6 204. Kg6 Nxe3 205. Kh6 Nf1 206. Kh5 Ke1 207. Kg6 Nd8 208. Kg7 Nf7 209. Kxf7 Kd1 210. Kf6 Ke2 211. Kg6 Nh2 212. Kh7 Ke3 213. Kg6 Nf1 214. Kg5 Nh2 215. Kh5 Kf4 216. g5 Ng4 217. g6 Nf6+ 218. Kh4 Ke4 219. g7 Nd7 220. Kh3 Kf4 221. Kh4 Kf3 222. Kh5 Nb6 223. g8=R Nd5 224. Rb8 Nf6+ 225. Kg5 Ng8 226. Rb2 Kg3 227. Rb7 Ne7 228. Kf6 Kf2 229. Kg7 Nd5 230. Rf7+ Kg3 231. Rc7 Kh2 232. Kg6 Nxc7"
  expect_equal(class(san2lan(movetext)), "character")
})
